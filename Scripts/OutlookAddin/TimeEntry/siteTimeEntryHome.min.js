function LoadClients(){try{$("#actionMessage").text("Loading Data..."),$.ajax({type:"POST",url:gl_ServicePath+"/GetClients",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=jQuery.parseJSON(e.d);t.hasOwnProperty("StatusCode")&&500==t.StatusCode?(ShowError(t.ErrorMessage),ShowDropdowns("LoadClients")):($("#ddlClient option").remove(),t.length>0?($("#ddlClient").removeAttr("disabled"),_.each(t,function(e,t,a){var i=_.template($("#listTemplate").text())(e);$("#ddlClient").append(i)}),LoadProjects("","",!1)):ShowDropdowns("LoadClients")),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show(),$("#actionMessage").text("")},error:function(e){ShowError("Error loading data."),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show(),$("#actionMessage").text("")}})}catch(e){ShowError("Error loading data."),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show(),$("#actionMessage").text("")}}function LoadProjects(e,t,a){try{$("#taskDiv").hide(),$("#projectDiv").hide(),$("#dropdownloadingImage").show(),$("#dropdownActionMessage").text("Loading Projects and Tasks Data..."),$("#ddlClient").attr("disabled","disabled");var i=$("#ddlClient :selected").val(),l=$("#ddlClient :selected").text(),r=$("#ddlClient :selected").attr("data-uri"),o={ItemID:i,Name:l,GetAssignmentsURI:r};$.ajax({type:"POST",url:gl_ServicePath+"/GetProjects",data:'{"client" : '+JSON.stringify(o)+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){var l=jQuery.parseJSON(i.d);l.hasOwnProperty("StatusCode")&&500==l.StatusCode?(ShowError(l.ErrorMessage),ShowDropdowns("LoadProjects")):($("#ddlProject option").remove(),l.length>0?($("#ddlProject").removeAttr("disabled"),_.each(l,function(e,t,a){var i=_.template($("#listTemplate").text())(e);$("#ddlProject").append(i)}),""!=e?($("#ddlProject").val(e),LoadTasks(t,a)):LoadTasks("",a)):ShowDropdowns("LoadProjects"),$("#projectDiv").show())},error:function(e){ShowError("Error loading data."),$("#taskDiv").show(),$("#projectDiv").show(),$("#dropdownloadingImage").hide(),$("#dropdownActionMessage").text(""),$("#ddlClient").removeAttr("disabled")}})}catch(s){ShowError("Error loading data."),$("#taskDiv").show(),$("#projectDiv").show(),$("#dropdownloadingImage").hide(),$("#dropdownActionMessage").text(""),$("#ddlClient").removeAttr("disabled")}}function LoadTasks(e,t){try{$("#taskDiv").hide(),$("#dropdownloadingImage").show(),$("#dropdownActionMessage").text("Loading Task Data..."),$("#ddlProject").attr("disabled","disabled");var a=$("#ddlProject :selected").val(),i=$("#ddlProject :selected").text(),l=$("#ddlProject :selected").attr("data-uri"),r={ItemID:a,Name:i,GetAssignmentsURI:l};$.ajax({type:"POST",url:gl_ServicePath+"/GetTask",data:'{"project": '+JSON.stringify(r)+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){var i=jQuery.parseJSON(a.d);i.hasOwnProperty("StatusCode")&&500==i.StatusCode?ShowError(i.ErrorMessage):($("#ddlTask option").remove(),i.length>0?($("#ddlTask").removeAttr("disabled"),_.each(i,function(e,t,a){var i=_.template($("#listTemplate").text())(e);$("#ddlTask").append(i)}),""!=e&&$("#ddlTask").val(e),CheckUncheckBillable(t)):$("#ddlTask").attr("disabled","disabled")),ShowDropdowns("LoadTasks"),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show()},error:function(e){ShowError("Error loading data."),ShowDropdowns("LoadTasks"),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show(),$("#actionMessage").text("")}})}catch(o){ShowError("Error loading data."),ShowDropdowns("LoadTasks"),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show(),$("#actionMessage").text("")}}function CheckUncheckBillable(e){try{var t=$("#ddlTask :selected").attr("data-IsBillable"),a=getCookie("APIVersion");e?a>5&&("T"==t?($("#chkBillable").prop("disabled",!0),$("#meetingChkBillable").prop("disabled",!0)):"F"==t?($("#chkBillable").prop("disabled",!0),$("#meetingChkBillable").prop("disabled",!0)):($("#meetingChkBillable").removeProp("disabled"),$("#chkBillable").removeProp("disabled"))):5==a?"T"==t?($("#meetingChkBillable").prop("checked",!0),$("#chkBillable").prop("checked",!0)):($("#meetingChkBillable").prop("checked",!1),$("#chkBillable").prop("checked",!1)):"T"==t?(console.log("Tasks is T"),$("#meetingChkBillable").prop("checked",!0),$("#chkBillable").prop("checked",!0),$("#chkBillable").prop("disabled",!0),$("#meetingChkBillable").prop("disabled",!0)):"F"==t?(console.log("Tasks is F"),$("#meetingChkBillable").prop("checked",!1),$("#chkBillable").prop("checked",!1),$("#chkBillable").prop("disabled",!0),$("#meetingChkBillable").prop("disabled",!0)):(console.log("Tasks is U"),$("#meetingChkBillable").prop("checked",!0),$("#chkBillable").prop("checked",!0),$("#meetingChkBillable").removeProp("disabled"),$("#chkBillable").removeProp("disabled")),LoadCustomTemplates(e)}catch(i){ShowError("Error loading data.")}}function SetBillableCheckBoxVisibility(){try{$.ajax({type:"POST",url:gl_ServicePath+"/GetEmployeeOptions",data:{},contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(employeeOptions=jQuery.parseJSON(e.d),employeeOptions.hasOwnProperty("StatusCode")&&500==employeeOptions.StatusCode)ShowError(responseData.ErrorMessage);else{var t=getCookie("APIVersion");5==t&&("T"==employeeOptions.ShowBillable?($("#meetingChkBillable").removeProp("disabled"),$("#chkBillable").removeProp("disabled")):($("#chkBillable").prop("disabled",!0),$("#meetingChkBillable").prop("disabled",!0)))}},error:function(e){ShowError("Error loading data.")}})}catch(e){ShowError("Error loading data.")}}function LoadCustomTemplates(e){try{$("#customFields").hide(),$("#customLoadingImage").show();var t=$("#ddlTask :selected").val();$.ajax({type:"POST",url:gl_ServicePath+"/GetCustomTemplates",data:'{"taskId": "'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(timeEntry_CustomData=jQuery.parseJSON(t.d),timeEntry_CustomData.hasOwnProperty("StatusCode")&&500==timeEntry_CustomData.StatusCode)ShowError(responseData.ErrorMessage);else{LoadCustomTemplatesWithDefaultData();var a=$("#timeEntryId").val();(e||""!=a)&&BindCustomTemplateDetails(timeEntriesData)}},error:function(e){ShowError("Error loading data."),$("#customLoadingImage").hide(),$("#customFields").show()}})}catch(a){ShowError("Error loading data."),$("#customLoadingImage").hide(),$("#customFields").show()}}function DisplayMeetingDivs(){void 0!=outlookItem?"appointment"==outlookItem.getItemType()?($("#meetingTimeDetails").show(),$("#nonMeetingTimeDetails").hide(),getMeetingStartEndTime()):($("#description").val(""),$("#txtBillable").val(""),$("#meetingTimeDetails").hide(),$("#nonMeetingTimeDetails").show()):($("#description").val(""),$("#txtBillable").val(""),$("#chkBillable").attr("checked",!1),$("#meetingTimeDetails").hide(),$("#nonMeetingTimeDetails").show())}function LoadCustomTemplatesWithDefaultData(){_.isEmpty(timeEntry_CustomData)?($("#customFields").html(""),$("#customFields").hide(),$("#customLoadingImage").hide()):($("#customFields").html(""),_.each(timeEntry_CustomData,function(e,t,a){switch(e.Type){case"A":self.$list=$("#customFields");var i=_.template($("#alphanumericTemplate").text())(e);if(void 0!=e.Values&&void 0!=e.Values[0]){var l="";l="T"==e.Values[0].Default?$($.parseHTML(i)).find("textarea").val(e.Values[0].Value):$($.parseHTML(i)).find("textarea");var r=$($.parseHTML(i)).children("textarea").remove().end(),o=l.insertAfter(r.find("label"));void 0!=o&&void 0!=o[0]&&self.$list.append(o[0].parentElement)}else self.$list.append(i);break;case"N":self.$list=$("#customFields");var i=_.template($("#numericTemplate").text())(e);if(void 0!=e.Values&&void 0!=e.Values[0]){var l="";l="T"==e.Values[0].Default?$($.parseHTML(i)).find("input").attr("value",e.Values[0].Value):$($.parseHTML(i)).find("input");var r=$($.parseHTML(i)).children("input").remove().end(),o=l.insertAfter(r.find("label"));void 0!=o&&void 0!=o[0]&&self.$list.append(o[0].parentElement)}else self.$list.append(i);break;case"D":self.$list=$("#customFields");var i=_.template($("#datetimepickerTemplate").text())(e);self.$list.append(i),void 0!=e.Values&&void 0!=e.Values[0]?($("#"+e.Id).datetimepicker({format:"MM/DD/YYYY",ignoreReadonly:!0}).on("dp.change",function(t){var a=$("#"+e.Id).find("input.form-control").val();""!=a?$("#"+e.Id+"_label").addClass("show"):$("#"+e.Id+"_label").removeClass("show")}),"T"==e.Values[0].Default&&($("#"+e.Id).find("input.form-control").val(moment(e.Values[0].Value).format("MM/DD/YYYY")),$("#"+e.Id+"_label").addClass("show"))):$("#"+e.Id).datetimepicker({format:"MM/DD/YYYY",ignoreReadonly:!0}).on("dp.change",function(t){var a=$("#"+e.Id).find("input.form-control").val();""!=a?$("#"+e.Id+"_label").addClass("show"):$("#"+e.Id+"_label").removeClass("show")});break;case"M":self.$list=$("#customFields");var s=[],i=_.template($("#multiSelectTemplate").text())(e);self.$list.append(i),void 0!=e.Values&&void 0!=e.Values[0]&&_.each(e.Values,function(t,a,i){var l=_.template($("#selectOptionTemplate").text())(t);$("#"+e.Id).append(l),"T"==t.Default&&s.push(t.Value)});var d="T"==e.Required?e.Name+" *":e.Name;$("#"+e.Id).multiselect({numberDisplayed:0,nonSelectedText:d,onChange:function(t,a,i){var l=$("#"+e.Id+" option:selected"),r=[];$(l).each(function(e,t){r.push([$(this).val()])}),r.length>0?$("#"+e.Id+"_label").addClass("show"):$("#"+e.Id+"_label").removeClass("show")}}),s.length>0&&$("#"+e.Id).multiselect("select",s,!0),$(".caret").css("float","right").css("margin-top","8px"),$("span.multiselect-native-select>.btn-group>.btn:first-child>span").css("float","left");break;case"X":self.$list=$("#customFields");var i=_.template($("#exclusiveSelectTemplate").text())(e);self.$list.append(i);var s=[];void 0!=e.Values&&void 0!=e.Values[0]&&_.each(e.Values,function(t,a,i){var l=_.template($("#selectOptionTemplate").text())(t);$("#"+e.Id).append(l),"T"==t.Default&&s.push(t.Value)});var n="T"==e.Required?e.Name+" *":e.Name;if($("#"+e.Id).multiselect({numberDisplayed:1,nonSelectedText:n,onChange:function(t,a,i){var l=$("#"+e.Id+" option:selected"),r=[];$(l).each(function(e,t){r.push([$(this).val()])}),r.length>0?$("#"+e.Id+"_label").addClass("show"):$("#"+e.Id+"_label").removeClass("show")}}),s.length>0){var m=$("#"+e.Id).parent("span").find("button.multiselect").prop("title");$("#"+e.Id).multiselect("deselect",m,!0),$("#"+e.Id).multiselect("select",s[0],!0)}$("#"+e.Id+"_label").addClass("show"),$(".caret").css("float","right").css("margin-top","8px"),$("span.multiselect-native-select>.btn-group>.btn:first-child>span").css("float","left")}}),$("#customLoadingImage").hide(),$("#customFields").show(),SetFloatingLabelsForInputAndSelect())}function SetFloatingLabelsForInputAndSelect(){var e="show";$("input, textarea").bind("checkval",function(){var t=$(this).prev(".label_floating_label");""!==this.value?t.addClass(e):t.removeClass(e)}).on("keyup",function(){$(this).trigger("checkval")}).trigger("checkval"),$("#txtBillable").bind("checkvalue",function(){""!==this.value?$("#floatingLabelHours").addClass(e):$("#floatingLabelHours").removeClass(e)}).on("keyup",function(){$(this).trigger("checkvalue")}).trigger("checkvalue"),$("#meetingStartTime, #meetingEndTime").bind("checkvalue",function(){""!==$("#meetingEndTime").val()||""!==$("#meetingStartTime, #meetingEndTime").val()?$("#floatingLabelMeeting").addClass(e):$("#floatingLabelMeeting").removeClass(e)}).on("keyup",function(){$(this).trigger("checkvalue")}).trigger("checkvalue")}function getMeetingStartEndTime(){try{var e,t=outlookItem.itemId;if(null===t||void 0==t)outlookItem.start.getAsync(function(t){t.status==Office.AsyncResultStatus.Failed?ShowTimeEntryDetailsError("Error loading meeting start time data."):(""!=t.value&&$("#floatingLabelMeeting").addClass("show"),$("#meetingStartTime").val(moment(t.value).format("hh:mm A")),e=moment(t.value),outlookItem.end.getAsync(function(t){if(t.status==Office.AsyncResultStatus.Failed)ShowTimeEntryDetailsError("Error loading meeting end time data.");else{""!=t.value&&$("#floatingLabelMeeting").addClass("show"),$("#meetingEndTime").val(moment(t.value).format("hh:mm A"));var a=Math.round(100*moment.duration(moment(t.value).diff(e)).asHours())/100;$("#meetingTotalHours").text(a+"h"),outlookItem.subject.getAsync(function(e){e.status==Office.AsyncResultStatus.Failed?ShowTimeEntryDetailsError("Error loading meeting subject data."):(""!=e.value&&$("#description").parent(".control-div").find("label.label_floating_label").addClass("show"),$("#description").val(e.value))})}}))});else{$("#floatingLabelMeeting").addClass("show"),$("#meetingStartTime").val(moment(outlookItem.start).format("hh:mm A")),e=moment(outlookItem.start),$("#floatingLabelMeeting").addClass("show"),$("#meetingEndTime").val(moment(outlookItem.end).format("hh:mm A"));var a=Math.round(100*moment.duration(moment(outlookItem.end).diff(e)).asHours())/100;$("#meetingTotalHours").text(a+"h"),$("#description").parent(".control-div").find("label.label_floating_label").addClass("show"),$("#description").val(outlookItem.subject)}}catch(i){ShowTimeEntryDetailsError("Error loading data.")}}function SaveTimeEntry(){try{validateData.isvalid=!0,HideAllError();var e=$("#timeEntryId").val(),t=$("#ddlClient :selected").val(),a=$("#ddlProject :selected").val(),i=$("#ddlTask :selected").val(),l=$("#weeklyHours").find(".weekly_day.selected").attr("data-value"),r=moment(l).format("MM/DD/YYYY"),o=moment(l).format("MM/DD/YYYY"),s="",d=$("#description").val(),n="",m=$("#isCalenderEntry").val();if("true"==m){if(ValidateMeetingEntries($("#meetingStartTime").val(),$("#meetingEndTime").val()),!validateData.isvalid)return $(window).scrollTop($("#homePageContainer").position().top),!1;var c=moment($("#meetingStartTime").val(),"LT").format("hh:mm A"),u=moment($("#meetingEndTime").val(),"LT").format("hh:mm A"),h=(Math.round(100*moment(u,"hh:mm a").diff(moment(c,"hh:mm a"),"hours",!0))/100).toString();s=h,n=$("#meetingChkBillable").prop("checked")}else s=$("#txtBillable").val(),n=$("#chkBillable").prop("checked");var p={TimeEntryId:e,ClientId:t,ProjectId:a,TaskId:i,StartDate:r,EndDate:o,Hours:s,Description:d,IsBillableHours:n,FromCalendar:m,StartTime:c,StopTime:u,CustomFields:[]};if($("[data-type^='custom_']").each(function(e,t){var a=t.attributes["data-type"].value,i="",l={Id:"",TemplateId:"",Values:[]};if(i=a.split("_"),""!=i&&void 0!=i[1])switch(i[1]){case"numeric":l.Id=t.attributes["data-guid"].value,l.TemplateId=t.id,""!=t.value.trim()&&l.Values.push(t.value),p.CustomFields.push(l);break;case"alphanumeric":l.Id=t.attributes["data-guid"].value,l.TemplateId=t.id,""!=t.value.trim()&&l.Values.push(t.value),p.CustomFields.push(l);break;case"datePicker":l.Id=t.attributes["data-guid"].value,l.TemplateId=t.id;var r=$("#"+t.id).find("input").val();""!=r&&l.Values.push(moment(r).format("MM/DD/YYYY")),p.CustomFields.push(l);break;case"multipleselect":l.Id=t.attributes["data-guid"].value,l.TemplateId=t.id;var o=$("#"+t.id+" option:selected");o.length>0&&$.each(o,function(e,t){l.Values.push(t.value.trim())}),p.CustomFields.push(l);break;case"exclusiveSelect":l.Id=t.attributes["data-guid"].value,l.TemplateId=t.id;var o=$("#"+t.id).parent("span").find("button.multiselect").prop("title"),s=$("#"+t.id).attr("placeholder");o.trim()!=s.trim()&&l.Values.push(o),p.CustomFields.push(l)}}),ValidateTimeEntryDetails(p),validateData.isvalid){$("#tabs").hide(),$("#content").hide(),$("#loadingImage").show(),$("#actionMessage").text("Saving Time Entry...");var v=JSON.stringify(p);$.ajax({type:"POST",url:gl_ServicePath+"/SaveTimeEntry",data:'{"timeEntry": '+v+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(e.d){var t=jQuery.parseJSON(e.d);t.hasOwnProperty("StatusCode")&&500==t.StatusCode&&ShowTimeEntryDetailsError(t.ErrorMessage),$("#tabs").show(),$("#content").show(),$("#loadingImage").hide()}else LoadWeekHours(!1,l),LoadTimeEntryViews();$("#actionMessage").text("")},error:function(e){ShowTimeEntryDetailsError("Error saving data."),$("#tabs").show(),$("#content").show(),$("#loadingImage").hide(),$("#actionMessage").text("")}})}else ShowTimeEntryDetailsError("Please check errors below."),$("#tabs").show(),$("#content").show(),$("#loadingImage").hide(),$("#actionMessage").text(""),$(window).scrollTop($("#homePageContainer").position().top)}catch(g){ShowTimeEntryDetailsError("Error saving data."),$("#tabs").show(),$("#content").show(),$("#loadingImage").hide(),$("#actionMessage").text("")}}function ValidateTimeEntryDetails(e){RemoveControlErrorStyle(),requiredValidator.isAcceptable(e.ClientId)?($("#errorClient").removeClass("show"),$("#ddlClient").removeClass("red-outline")):(validateData.isvalid=!1,$("#errorClient").addClass("show"),$("#ddlClient").addClass("red-outline")),requiredValidator.isAcceptable(e.ProjectId)?($("#errorProject").removeClass("show"),$("#ddlProject").removeClass("red-outline")):(validateData.isvalid=!1,$("#errorProject").addClass("show"),$("#ddlProject").addClass("red-outline")),requiredValidator.isAcceptable(e.TaskId)?($("#errorTask").removeClass("show"),$("#ddlTask").removeClass("red-outline")):(validateData.isvalid=!1,$("#errorTask").addClass("show"),$("#ddlTask").addClass("red-outline")),e.Description.length>4e3?(validateData.isvalid=!1,$("#errorDescription").addClass("show"),$("#description").addClass("red-outline")):($("#errorDescription").removeClass("show"),$("#description").removeClass("red-outline")),requiredValidator.isAcceptable(e.Hours)?hourValidator.isAcceptable(e.Hours)?0==parseFloat(Number(e.Hours))?(validateData.isvalid=!1,$("#errorHours").text("Hours must be greater than zero."),$("#errorHours").addClass("show"),$("#txtBillable").addClass("red-outline")):($("#errorHours").removeClass("show"),$("#txtBillable").removeClass("red-outline")):(validateData.isvalid=!1,$("#errorHours").text("Enter data in numeric format with 2 decimal places."),$("#errorHours").addClass("show"),$("#txtBillable").addClass("red-outline")):(validateData.isvalid=!1,$("#errorHours").text("Hours field cannot be empty."),$("#errorHours").addClass("show"),$("#txtBillable").addClass("red-outline")),"true"==e.FromCalendar&&ValidateMeetingEntries(e.StartTime,e.StopTime),$.each(e.CustomFields,function(e,t){var a=$("#"+t.TemplateId).attr("data-type").split("_"),i=$("#"+t.TemplateId).attr("data-required");switch(a[1]){case"numeric":"T"==i&&(t.Values.length>0&&requiredValidator.isAcceptable(t.Values[0])?($("#"+t.TemplateId+"_errorCustomNumeric").removeClass("show"),$("#"+t.TemplateId).removeClass("red-outline")):(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorCustomNumeric").text("Custom Numeric data is required."),$("#"+t.TemplateId+"_errorCustomNumeric").addClass("show"),$("#"+t.TemplateId).addClass("red-outline"))),void 0!=t.Values&&void 0!=t.Values[0]&&(numericValidator.isAcceptable(t.Values[0])?($("#"+t.TemplateId+"_errorCustomNumeric").removeClass("show"),$("#"+t.TemplateId).removeClass("red-outline")):(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorCustomNumeric").text("Enter data in numeric format only."),$("#"+t.TemplateId+"_errorCustomNumeric").addClass("show"),$("#"+t.TemplateId).addClass("red-outline")));break;case"alphanumeric":"T"==i&&(t.Values.length>0&&requiredValidator.isAcceptable(t.Values[0])?($("#"+t.TemplateId+"_errorCustomAlphaNumeric").removeClass("show"),$("#"+t.TemplateId).removeClass("red-outline")):(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorCustomAlphaNumeric").text("Custom alphanumeric data is required."),$("#"+t.TemplateId+"_errorCustomAlphaNumeric").addClass("show"),$("#"+t.TemplateId).addClass("red-outline"))),void 0!=t.Values&&void 0!=t.Values[0]&&(alphanumericValidator.isAcceptable(t.Values[0])?($("#"+t.TemplateId+"_errorCustomAlphaNumeric").removeClass("show"),$("#"+t.TemplateId).removeClass("red-outline")):(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorCustomAlphaNumeric").text("Special characters are not allowed."),$("#"+t.TemplateId+"_errorCustomAlphaNumeric").addClass("show"),$("#"+t.TemplateId).addClass("red-outline")));break;case"datePicker":"T"==i&&(t.Values.length>0&&requiredValidator.isAcceptable(t.Values[0])?($("#"+t.TemplateId+"_errorCustomdate").removeClass("show"),$("#"+t.TemplateId).removeClass("red-outline")):(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorCustomdate").text("Custom date is required."),$("#"+t.TemplateId+"_errorCustomdate").addClass("show"),$("#"+t.TemplateId).addClass("red-outline"))),void 0!=t.Values&&void 0!=t.Values[0]&&(dateValidator.isAcceptable(t.Values[0])?($("#"+t.TemplateId+"_errorCustomdate").removeClass("show"),$("#"+t.TemplateId).removeClass("red-outline")):(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorCustomdate").text("Custom date provided is out of range."),$("#"+t.TemplateId+"_errorCustomdate").addClass("show"),$("#"+t.TemplateId).addClass("red-outline")));break;case"multipleselect":void 0!=t.Values&&"T"==i&&(!t.Values.length>0?(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorMultiple").addClass("show"),$("#"+t.TemplateId).parent("span.multiselect-native-select").find("button.multiselect").addClass("red-outline")):($("#"+t.TemplateId+"_errorMultiple").removeClass("show"),$("#"+t.TemplateId).parent("span.multiselect-native-select").find("button.multiselect").removeClass("red-outline")));break;case"exclusiveSelect":void 0!=t.Values&&"T"==i&&(!t.Values.length>0?(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorExclusive").addClass("show"),$("#"+t.TemplateId).parent("span.multiselect-native-select").find("button.multiselect").addClass("red-outline")):"[None]"==t.Values[0]?(validateData.isvalid=!1,$("#"+t.TemplateId+"_errorExclusive").addClass("show"),$("#"+t.TemplateId).parent("span.multiselect-native-select").find("button.multiselect").addClass("red-outline")):($("#"+t.TemplateId+"_errorExclusive").removeClass("show"),$("#"+t.TemplateId).parent("span.multiselect-native-select").find("button.multiselect").removeClass("red-outline")))}})}function ValidateMeetingEntries(e,t){var a=!1;requiredValidator.isAcceptable(e)||(validateData.isvalid=!1,$("#errorMeetingDetails").text("Start/Stop time field cannot be empty."),$("#errorMeetingDetails").addClass("show"),$("#meetingStartTime").addClass("red-outline"),a=!0),requiredValidator.isAcceptable(t)||(validateData.isvalid=!1,$("#errorMeetingDetails").text("Start/Stop time field cannot be empty."),$("#errorMeetingDetails").addClass("show"),$("#meetingEndTime").addClass("red-outline"),a=!0),timeValidator.isAcceptable(e)?timeValidator.isAcceptable(t)?moment(t,"LT").isAfter(moment(e,"LT"))||(validateData.isvalid=!1,$("#errorMeetingDetails").text("Start time cannot be greater than Stop time."),$("#errorMeetingDetails").addClass("show"),$("#meetingEndTime").addClass("red-outline"),a=!0):(validateData.isvalid=!1,$("#errorMeetingDetails").text("Start/Stop time is not in correct format."),$("#errorMeetingDetails").addClass("show"),$("#meetingEndTime").addClass("red-outline"),a=!0):(validateData.isvalid=!1,$("#errorMeetingDetails").text("Start/Stop time is not in correct format."),$("#errorMeetingDetails").addClass("show"),$("#meetingStartTime").addClass("red-outline"),a=!0),a||($("#errorMeetingDetails").removeClass("show"),$("#meetingEndTime").removeClass("red-outline"))}function RemoveControlErrorStyle(){$("#timeEntryDetailsContainer").find(".red-outline").removeClass("red-outline"),$("#timeEntryDetailsContainer").find(".error_floating_label").removeClass("show")}function TriggerEvents(){$("input, textarea").trigger("checkval"),$("#txtBillable").trigger("checkvalue"),$("#meetingStartTime, #meetingEndTime").trigger("checkvalue")}function ShowDropdowns(e){"LoadClients"==e?($("#ddlClient").attr("disabled","disabled"),$("#ddlProject option").remove(),$("#ddlProject").attr("disabled","disabled"),$("#ddlTask option").remove(),$("#ddlTask").attr("disabled","disabled")):"LoadProjects"==e?($("#ddlClient").removeAttr("disabled"),$("#ddlProject").attr("disabled","disabled"),$("#ddlTask option").remove(),$("#ddlTask").attr("disabled","disabled")):"LoadTasks"==e&&($("#ddlClient").removeAttr("disabled"),$("#ddlProject").removeAttr("disabled")),$("#taskDiv").show(),$("#projectDiv").show(),$("#dropdownloadingImage").hide(),$("#dropdownActionMessage").text("")}function GetMeetingTimeDuration(){validateData.isvalid=!0,$("#meetingTotalHours").text("");var e=moment($("#meetingStartTime").val(),"LT").format("hh:mm A"),t=moment($("#meetingEndTime").val(),"LT").format("hh:mm A");if("Invalid date"!=e&&$("#meetingStartTime").val(e),"Invalid date"!=t&&$("#meetingEndTime").val(t),ValidateMeetingEntries($("#meetingStartTime").val(),$("#meetingEndTime").val()),validateData.isvalid){var a=(Math.round(100*moment(t,"hh:mm a").diff(moment(e,"hh:mm a"),"hours",!0))/100).toString();$("#meetingTotalHours").text(a+"h")}}function getCookie(e){for(var t=e+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var l=a[i];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(t))return l.substring(t.length,l.length)}return""}function LoadSingleDayEntry(e){try{if(e){var t=$("#tabTimeEntries").hasClass("active");if(!t){HideAllError();var a=$("#weeklyHours").find(".weekly_day.selected").attr("data-value"),i=moment(a).format("dddd");$("#weekDayName").find(".day_weekly_block.selected").removeClass("selected"),$("#"+i).addClass("selected"),RemoveControlErrorStyle(),LoadWeekHoursDetails(),LoadTimeEntries(a,a)}}else{HideAllError();var a=$("#weeklyHours").find(".weekly_day.selected").attr("data-value"),i=moment(a).format("dddd");$("#weekDayName").find(".day_weekly_block.selected").removeClass("selected"),$("#"+i).addClass("selected"),RemoveControlErrorStyle(),LoadWeekHoursDetails(),LoadTimeEntries(a,a)}}catch(l){ShowError("Error loading data.")}}function LoadWeekHoursDetails(){try{var e=$("#startDate").val(),t=$("#endDate").val();$("#weekHoursDetails").hide(),$.ajax({type:"POST",url:gl_ServicePath+"/GetTimeEntriesWeekHoursDetails",data:'{"start": "'+e+'", "end": "'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=jQuery.parseJSON(e.d);if(t.hasOwnProperty("StatusCode")&&500==t.StatusCode)ShowError(t.ErrorMessage);else{var a=t;null!=a&&(a.IsSubmitted?$("#btnSubmitTime").prop("disabled",!0):$("#btnSubmitTime").removeProp("disabled"),$("#weekTotalHours").text(a.WeekHoursTotal+"h"))}$("#weekHoursDetails").show()},error:function(e){ShowError("Error loading week hours data."),$("#weekHoursDetails").show()}})}catch(a){ShowError("Error loading week hours data."),$("#weekHoursDetails").show()}}function LoadTimeEntries(e,t){try{$(".timeEntriestab").css("display","none"),$("#timeEntriesLoadingImage").show(),$.ajax({type:"POST",url:gl_ServicePath+"/GetTimeEntries",data:'{"start": "'+e+'", "end": "'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t=jQuery.parseJSON(e.d);if(t.hasOwnProperty("StatusCode")&&500==t.StatusCode)ShowError(t.ErrorMessage),$("#timeEntriesLoadingImage").hide(),$(".timeEntriestab").css("display","block");else{$("#timeEntries").html(""),self.$list=$("#timeEntries"),_.each(t,function(e,t,a){var i=_.template($("#timeEntriesTemplate").text())(e);self.$list.append(i)});var a=$("#weeklyHours").find(".weekly_day.selected").attr("data-value"),i=moment(a).format("dddd"),l=moment(a).format("MMMM"),r=moment(a).format("DD"),o=moment(a).format("YYYY");$("#timeEntriesDate").text(i+" "+l+" "+r+", "+o),$("#timeEntriesLoadingImage").hide(),$(".timeEntriestab").css("display","block")}},error:function(e){ShowError("Error loading data."),$("#timeEntriesLoadingImage").hide(),$(".timeEntriestab").css("display","block")}})}catch(a){ShowError("Error loading data."),$("#timeEntriesLoadingImage").hide(),$(".timeEntriestab").css("display","block")}}function DeleteEntry(e){try{HideAllError();var t=$(e).attr("data-value");$("#tabs").hide(),$("#content").hide(),$("#loadingImage").show(),$("#actionMessage").text("Deleting Time Entry..."),$.ajax({type:"POST",url:gl_ServicePath+"/DeleteTimeEntry",data:'{"timeEntryId": "'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(e.d){var t=jQuery.parseJSON(e.d);t.hasOwnProperty("StatusCode")&&500==t.StatusCode&&ShowError(t.ErrorMessage),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show()}else{var a=$("#weeklyHours").find(".weekly_day.selected").attr("data-value");LoadTimeEntryViews(outlookItem),LoadWeekHours(!1,a),LoadSingleDayEntry(!1)}$("#actionMessage").text("")},error:function(e){ShowError("Error deleting time entry."),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show(),$("#actionMessage").text("")}})}catch(a){ShowError("Error deleting time entry."),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show(),$("#actionMessage").text("")}}function EditEntry(e){try{$("#tabs").hide(),$("#content").hide(),$("#loadingImage").show(),$("#actionMessage").text("Loading Data...");var t=$(e).attr("data-value");RemoveControlErrorStyle(),HideAllError(),$.ajax({type:"POST",url:gl_ServicePath+"/GetSingleTimeEntry",data:'{"timeEntryId": "'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){timeEntriesData=jQuery.parseJSON(e.d),timeEntriesData.hasOwnProperty("StatusCode")&&500==timeEntriesData.StatusCode?(ShowError(timeEntriesData.ErrorMessage),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show()):(BindEditEntryDetails(timeEntriesData),TriggerEvents(),$("#btnSave").val("Update Time")),$("#actionMessage").text("")},error:function(e){ShowError("Error loading data."),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show(),$("#actionMessage").text("")}})}catch(a){ShowError("Error loading data."),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show(),$("#actionMessage").text("")}}function SubmitTimeEntry(){try{$("#tabs").hide(),$("#content").hide(),$("#loadingImage").show(),$("#actionMessage").text("Submitting Time Entries..."),$.ajax({type:"POST",url:gl_ServicePath+"/SubmitWeekTimeEntry",data:'{"startDateOfWeek": "'+$("#startDate").val()+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(e.d){var e=jQuery.parseJSON(e.d);responseData.hasOwnProperty("StatusCode")&&500==responseData.StatusCode&&ShowError(responseData.ErrorMessage),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show()}else{var t=$("#weeklyHours").find(".weekly_day.selected").attr("data-value");LoadTimeEntryViews(outlookItem),LoadWeekHours(!1,t),LoadSingleDayEntry(!1)}$("#actionMessage").text("")},error:function(e){ShowError("Error submitting data."),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show(),$("#actionMessage").text("")}})}catch(e){ShowError("Error submitting data."),$("#loadingImage").hide(),$("#tabs").show(),$("#content").show(),$("#actionMessage").text("")}}function BindEditEntryDetails(e){try{if(void 0!=e&&void 0!=e[0]){$("#tabTimeEntryDetails").addClass("active"),$("#tabTimeEntries").removeClass("active"),$("#timeEntryDetailsContainer").addClass("active"),$("#timeEntriesContainer").removeClass("active"),$("#ddlClient").val(e[0].ClientId),LoadProjects(e[0].ProjectId,e[0].TaskId,!0),$("#timeEntryId").val(e[0].TimeEntryId),$("#description").val(e[0].Description),$("#txtBillable").val(e[0].BillableHours);try{var t=$("#isCalenderEntry").val();if("true"==t){var a=moment(e[0].StartTime,"LT").format("hh:mm A"),i=moment(e[0].StopTime,"LT").format("hh:mm A");$("#meetingStartTime").val(a),$("#meetingEndTime").val(i);var l=Math.round(100*moment(i,"hh:mm a").diff(moment(a,"hh:mm a"),"hours",!0))/100;$("#meetingTotalHours").text(l+"h")}}catch(r){ShowError("Error loading start and end time.")}"Billable"==e[0].IsBillable?($("#meetingChkBillable").prop("checked",!0),$("#chkBillable").prop("checked",!0)):($("#meetingChkBillable").prop("checked",!1),$("#chkBillable").prop("checked",!1)),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show()}else $("#loadingImage").hide(),$("#content").show(),
$("#tabs").show()}catch(r){ShowError("Error loading data."),$("#loadingImage").hide(),$("#content").show(),$("#tabs").show()}}function BindCustomTemplateDetails(e){void 0!=e&&void 0!=e[0]&&$("[data-type^='custom_']").each(function(t,a){var i=e[0].CustomFields.filter(function(e){return e.TemplateId===a.id}),l=a.attributes["data-type"].value,r="",o=$("#"+a.id);if(i.length>0){if(r=l.split("_"),""!=r&&void 0!=r[1])switch(r[1]){case"numeric":o.attr("data-guid",i[0].Id),o.val(void 0!=i[0].Values&&""!=i[0].Values[0]?i[0].Values[0]:"");break;case"alphanumeric":o.attr("data-guid",i[0].Id),void 0!=i[0].Values&&""!=i[0].Values[0]?o.val(i[0].Values[0]):o.text("");break;case"datePicker":o.attr("data-guid",i[0].Id),o.find("input.form-control").val(void 0!=i[0].Values&&""!=i[0].Values[0]?moment(i[0].Values[0]).format("MM/DD/YYYY"):""),o.trigger("dp.change");break;case"multipleselect":o.attr("data-guid",i[0].Id),o.multiselect("deselectAll",!1,!0),o.multiselect("updateButtonText"),void 0!=i[0].Values&&i[0].Values.length>0&&o.multiselect("select",i[0].Values,!0);break;case"exclusiveSelect":if(o.attr("data-guid",i[0].Id),$("option",o).each(function(e){o.multiselect("deselect",$(this).val(),!0)}),void 0!=i[0].Values&&""!=i[0].Values[0])o.multiselect("select",i[0].Values[0],!0);else{var s=$("#"+a.id+"_label").text();o.parent("span").find("button.multiselect").prop("title",s),o.parent("span").find("span.multiselect-selected-text").text(s)}}}else if(r=l.split("_"),""!=r&&void 0!=r[1])switch(r[1]){case"numeric":o.val("");break;case"alphanumeric":o.val(""),o.text("");break;case"datePicker":o.find("input.form-control").val("");break;case"multipleselect":o.multiselect("deselectAll",!1),o.multiselect("updateButtonText");break;case"exclusiveSelect":$("option",o).each(function(e){o.multiselect("deselect",$(this).val())});var d=$("#"+a.id+"_label").text();o.parent("span").find("button.multiselect").prop("title",d),o.parent("span").find("span.multiselect-selected-text").text(d),$("#"+a.id+"_label").removeClass("show")}})}function ToggleDetails(e){try{if($(e).toggleClass("rotate-180"),$(e).hasClass("rotate-180")){$(e).closest(".timeentry_upper").find("#clientName").show(),$(e).closest(".timeentry_upper").find("#shortProjectName").hide(),$(e).closest(".timeentry_upper").find("#fullProjectName").show();var t=$(e).closest(".task_details").find(".task-details-content").height()+Number($(e).attr("data-height"))+25;$(e).closest(".timeentry_upper").animate({height:t},{queue:!1,duration:400})}else $(e).closest(".timeentry_upper").animate({height:"60"},{queue:!1,duration:400}),$(e).closest(".timeentry_upper").find("#shortProjectName").show(),$(e).closest(".timeentry_upper").find("#fullProjectName").hide(),$(e).closest(".timeentry_upper").find("#clientName").hide(400)}catch(a){ShowError("Error loading data.")}}var timeEntry_CustomData="",validateData={isvalid:!0},requiredValidator=new Validator.RequiredValidator,numericValidator=new Validator.NumberValidator,alphanumericValidator=new Validator.AlphanumericValidator,timeValidator=new Validator.TimeValidator,dateValidator=new Validator.DateValidator,hourValidator=new Validator.HourValidator,timeEntriesData="";